# split estimation with SMC++
# go throught the following lines to finish the workflow 
# smc++ vcf2smc my.vcf.gz data/pop1.smc.gz <contig> pop1:ind1_1,ind1_2
# smc++ vcf2smc my.vcf.gz data/pop12.smc.gz <contig> pop1:ind1_1,ind1_2 pop2:ind2_1,ind2_2
# smc++ split -o split/ pop1/model.final.json pop2/model.final.json data/*.smc.gz
# smc++ plot joint.pdf split/model.final.json

# conda activate python2smc++

# 1. convert VCF from each sccafold for smc format including oone population
# pop 3 mantiqueira
for i in $(cat /media/labgenoma4/DATAPART6/bandriola/Scytalopus/SummaryStats/fst/1Mscaffolds.txt); do
    smc++ vcf2smc ~/Scytalopus/vcffiles/FinalVCFs/OnlySspeluncae_FilteredPCA_FilteredMax10missingDepthmin10max100_GeographicNames_allsamples.vcf.gz pop3$i.smc.gz $i pop3:NorteMantiqueira1_lin3,NorteMantiqueira2_lin3,NorteMantiqueira3_lin3,NorteMantiqueira4_lin3,SulMantiqueira2_lin3,SulMantiqueira3_lin3,SulMantiqueira4_lin3,SulMantiqueira5_lin3,Caparao_lin3
done

# 2. estimate 
# smc++ estimate <mutation rate> <data file> [<data file> ...]
# mutation rate per generation: 0,0000000025 
smc++ estimate --em-iterations 20 --ftol 1e-5 --knots 5 --spline cubic -o pop4/ --base pop4 0.0000000025 pop4VXBX01000010.1.smc.gz pop4VXBX01000098.1.smc.gz pop4VXBX01000100.1.smc.gz pop4VXBX01000102.1.smc.gz pop4VXBX01000122.1.smc.gz pop4VXBX01000330.1.smc.gz pop4VXBX01000364.1.smc.gz pop4VXBX01000450.1.smc.gz pop4VXBX01000457.1.smc.gz pop4VXBX01000547.1.smc.gz pop4VXBX01000560.1.smc.gz pop4VXBX01000659.1.smc.gz pop4VXBX01000768.1.smc.gz pop4VXBX01000771.1.smc.gz pop4VXBX01000774.1.smc.gz pop4VXBX01000786.1.smc.gz pop4VXBX01000798.1.smc.gz pop4VXBX01000899.1.smc.gz pop4VXBX01000991.1.smc.gz pop4VXBX01000994.1.smc.gz pop4VXBX01000995.1.smc.gz pop4VXBX01001047.1.smc.gz pop4VXBX01001048.1.smc.gz pop4VXBX01001056.1.smc.gz pop4VXBX01001175.1.smc.gz pop4VXBX01001194.1.smc.gz pop4VXBX01001289.1.smc.gz pop4VXBX01001290.1.smc.gz pop4VXBX01001361.1.smc.gz pop4VXBX01001501.1.smc.gz pop4VXBX01001503.1.smc.gz pop4VXBX01001580.1.smc.gz pop4VXBX01001585.1.smc.gz pop4VXBX01001600.1.smc.gz pop4VXBX01001608.1.smc.gz pop4VXBX01001698.1.smc.gz pop4VXBX01001702.1.smc.gz pop4VXBX01001788.1.smc.gz pop4VXBX01001798.1.smc.gz pop4VXBX01001802.1.smc.gz pop4VXBX01001890.1.smc.gz pop4VXBX01001934.1.smc.gz pop4VXBX01001954.1.smc.gz pop4VXBX01002012.1.smc.gz pop4VXBX01002109.1.smc.gz pop4VXBX01002127.1.smc.gz pop4VXBX01002337.1.smc.gz pop4VXBX01002363.1.smc.gz pop4VXBX01002369.1.smc.gz pop4VXBX01002494.1.smc.gz pop4VXBX01002496.1.smc.gz pop4VXBX01002499.1.smc.gz pop4VXBX01002566.1.smc.gz pop4VXBX01002579.1.smc.gz pop4VXBX01002712.1.smc.gz pop4VXBX01002725.1.smc.gz pop4VXBX01002742.1.smc.gz pop4VXBX01002809.1.smc.gz pop4VXBX01002915.1.smc.gz pop4VXBX01002916.1.smc.gz pop4VXBX01003000.1.smc.gz pop4VXBX01003014.1.smc.gz pop4VXBX01003097.1.smc.gz pop4VXBX01003108.1.smc.gz pop4VXBX01003191.1.smc.gz pop4VXBX01003263.1.smc.gz pop4VXBX01003377.1.smc.gz pop4VXBX01003474.1.smc.gz pop4VXBX01003483.1.smc.gz pop4VXBX01003639.1.smc.gz pop4VXBX01003661.1.smc.gz pop4VXBX01003745.1.smc.gz pop4VXBX01003747.1.smc.gz pop4VXBX01003748.1.smc.gz pop4VXBX01003755.1.smc.gz pop4VXBX01003761.1.smc.gz pop4VXBX01003777.1.smc.gz pop4VXBX01003868.1.smc.gz pop4VXBX01003871.1.smc.gz pop4VXBX01003936.1.smc.gz pop4VXBX01003991.1.smc.gz pop4VXBX01003997.1.smc.gz pop4VXBX01004000.1.smc.gz pop4VXBX01004046.1.smc.gz pop4VXBX01004071.1.smc.gz pop4VXBX01004089.1.smc.gz pop4VXBX01004176.1.smc.gz pop4VXBX01004178.1.smc.gz pop4VXBX01004221.1.smc.gz pop4VXBX01004249.1.smc.gz pop4VXBX01004312.1.smc.gz pop4VXBX01004397.1.smc.gz pop4VXBX01004400.1.smc.gz pop4VXBX01004429.1.smc.gz pop4VXBX01004435.1.smc.gz pop4VXBX01004442.1.smc.gz pop4VXBX01004450.1.smc.gz pop4VXBX01004599.1.smc.gz pop4VXBX01004609.1.smc.gz pop4VXBX01004616.1.smc.gz pop4VXBX01004732.1.smc.gz pop4VXBX01004733.1.smc.gz pop4VXBX01004838.1.smc.gz pop4VXBX01004892.1.smc.gz pop4VXBX01004936.1.smc.gz pop4VXBX01004943.1.smc.gz pop4VXBX01004959.1.smc.gz pop4VXBX01005001.1.smc.gz pop4VXBX01005110.1.smc.gz pop4VXBX01005113.1.smc.gz pop4VXBX01005118.1.smc.gz pop4VXBX01005186.1.smc.gz pop4VXBX01005210.1.smc.gz pop4VXBX01005245.1.smc.gz pop4VXBX01005247.1.smc.gz pop4VXBX01005253.1.smc.gz pop4VXBX01005266.1.smc.gz pop4VXBX01005325.1.smc.gz pop4VXBX01005327.1.smc.gz pop4VXBX01005335.1.smc.gz pop4VXBX01005349.1.smc.gz pop4VXBX01005472.1.smc.gz pop4VXBX01005473.1.smc.gz pop4VXBX01005595.1.smc.gz pop4VXBX01005632.1.smc.gz pop4VXBX01005702.1.smc.gz pop4VXBX01005740.1.smc.gz pop4VXBX01005867.1.smc.gz pop4VXBX01005888.1.smc.gz pop4VXBX01005896.1.smc.gz pop4VXBX01005992.1.smc.gz pop4VXBX01006119.1.smc.gz pop4VXBX01006127.1.smc.gz pop4VXBX01006128.1.smc.gz pop4VXBX01006199.1.smc.gz pop4VXBX01006201.1.smc.gz pop4VXBX01006211.1.smc.gz pop4VXBX01006417.1.smc.gz pop4VXBX01006518.1.smc.gz pop4VXBX01006519.1.smc.gz pop4VXBX01006670.1.smc.gz pop4VXBX01006700.1.smc.gz pop4VXBX01006773.1.smc.gz pop4VXBX01006808.1.smc.gz pop4VXBX01006869.1.smc.gz pop4VXBX01006871.1.smc.gz pop4VXBX01006882.1.smc.gz pop4VXBX01006887.1.smc.gz pop4VXBX01007003.1.smc.gz pop4VXBX01007086.1.smc.gz pop4VXBX01007117.1.smc.gz pop4VXBX01007125.1.smc.gz pop4VXBX01007131.1.smc.gz pop4VXBX01007486.1.smc.gz pop4VXBX01007491.1.smc.gz pop4VXBX01007493.1.smc.gz pop4VXBX01007602.1.smc.gz pop4VXBX01007692.1.smc.gz pop4VXBX01007701.1.smc.gz pop4VXBX01007708.1.smc.gz pop4VXBX01007777.1.smc.gz pop4VXBX01007795.1.smc.gz pop4VXBX01007914.1.smc.gz pop4VXBX01007981.1.smc.gz pop4VXBX01007997.1.smc.gz pop4VXBX01008007.1.smc.gz pop4VXBX01008012.1.smc.gz pop4VXBX01008036.1.smc.gz pop4VXBX01008045.1.smc.gz pop4VXBX01008125.1.smc.gz pop4VXBX01008133.1.smc.gz pop4VXBX01008140.1.smc.gz pop4VXBX01008145.1.smc.gz pop4VXBX01008146.1.smc.gz pop4VXBX01008206.1.smc.gz pop4VXBX01008231.1.smc.gz pop4VXBX01008236.1.smc.gz pop4VXBX01008290.1.smc.gz pop4VXBX01008400.1.smc.gz pop4VXBX01008415.1.smc.gz pop4VXBX01008451.1.smc.gz pop4VXBX01008453.1.smc.gz pop4VXBX01008464.1.smc.gz pop4VXBX01008609.1.smc.gz pop4VXBX01008674.1.smc.gz pop4VXBX01008688.1.smc.gz pop4VXBX01008695.1.smc.gz pop4VXBX01008995.1.smc.gz pop4VXBX01009008.1.smc.gz pop4VXBX01009038.1.smc.gz pop4VXBX01009069.1.smc.gz pop4VXBX01009108.1.smc.gz pop4VXBX01009114.1.smc.gz pop4VXBX01009215.1.smc.gz pop4VXBX01009292.1.smc.gz pop4VXBX01009313.1.smc.gz pop4VXBX01009318.1.smc.gz pop4VXBX01009357.1.smc.gz pop4VXBX01009439.1.smc.gz pop4VXBX01009446.1.smc.gz pop4VXBX01009452.1.smc.gz pop4VXBX01009469.1.smc.gz pop4VXBX01009535.1.smc.gz pop4VXBX01009581.1.smc.gz pop4VXBX01009582.1.smc.gz pop4VXBX01009584.1.smc.gz pop4VXBX01009605.1.smc.gz pop4VXBX01009614.1.smc.gz pop4VXBX01009752.1.smc.gz pop4VXBX01009827.1.smc.gz pop4VXBX01009832.1.smc.gz pop4VXBX01009855.1.smc.gz pop4VXBX01009899.1.smc.gz pop4VXBX01009908.1.smc.gz pop4VXBX01009921.1.smc.gz pop4VXBX01017515.1.smc.gz
smc++ estimate --em-iterations 20 --ftol 1e-5 --knots 5 --spline cubic -o pop3/ --base pop3 0.0000000025 pop3VXBX01000010.1.smc.gz pop3VXBX01000098.1.smc.gz pop3VXBX01000100.1.smc.gz pop3VXBX01000102.1.smc.gz pop3VXBX01000122.1.smc.gz pop3VXBX01000330.1.smc.gz pop3VXBX01000364.1.smc.gz pop3VXBX01000450.1.smc.gz pop3VXBX01000457.1.smc.gz pop3VXBX01000547.1.smc.gz pop3VXBX01000560.1.smc.gz pop3VXBX01000659.1.smc.gz pop3VXBX01000768.1.smc.gz pop3VXBX01000771.1.smc.gz pop3VXBX01000774.1.smc.gz pop3VXBX01000786.1.smc.gz pop3VXBX01000798.1.smc.gz pop3VXBX01000899.1.smc.gz pop3VXBX01000991.1.smc.gz pop3VXBX01000994.1.smc.gz pop3VXBX01000995.1.smc.gz pop3VXBX01001047.1.smc.gz pop3VXBX01001048.1.smc.gz pop3VXBX01001056.1.smc.gz pop3VXBX01001175.1.smc.gz pop3VXBX01001194.1.smc.gz pop3VXBX01001289.1.smc.gz pop3VXBX01001290.1.smc.gz pop3VXBX01001361.1.smc.gz pop3VXBX01001501.1.smc.gz pop3VXBX01001503.1.smc.gz pop3VXBX01001580.1.smc.gz pop3VXBX01001585.1.smc.gz pop3VXBX01001600.1.smc.gz pop3VXBX01001608.1.smc.gz pop3VXBX01001698.1.smc.gz pop3VXBX01001702.1.smc.gz pop3VXBX01001788.1.smc.gz pop3VXBX01001798.1.smc.gz pop3VXBX01001802.1.smc.gz pop3VXBX01001890.1.smc.gz pop3VXBX01001934.1.smc.gz pop3VXBX01001954.1.smc.gz pop3VXBX01002012.1.smc.gz pop3VXBX01002109.1.smc.gz pop3VXBX01002127.1.smc.gz pop3VXBX01002337.1.smc.gz pop3VXBX01002363.1.smc.gz pop3VXBX01002369.1.smc.gz pop3VXBX01002494.1.smc.gz pop3VXBX01002496.1.smc.gz pop3VXBX01002499.1.smc.gz pop3VXBX01002566.1.smc.gz pop3VXBX01002579.1.smc.gz pop3VXBX01002712.1.smc.gz pop3VXBX01002725.1.smc.gz pop3VXBX01002742.1.smc.gz pop3VXBX01002809.1.smc.gz pop3VXBX01002915.1.smc.gz pop3VXBX01002916.1.smc.gz pop3VXBX01003000.1.smc.gz pop3VXBX01003014.1.smc.gz pop3VXBX01003097.1.smc.gz pop3VXBX01003108.1.smc.gz pop3VXBX01003191.1.smc.gz pop3VXBX01003263.1.smc.gz pop3VXBX01003377.1.smc.gz pop3VXBX01003474.1.smc.gz pop3VXBX01003483.1.smc.gz pop3VXBX01003639.1.smc.gz pop3VXBX01003661.1.smc.gz pop3VXBX01003745.1.smc.gz pop3VXBX01003747.1.smc.gz pop3VXBX01003748.1.smc.gz pop3VXBX01003755.1.smc.gz pop3VXBX01003761.1.smc.gz pop3VXBX01003777.1.smc.gz pop3VXBX01003868.1.smc.gz pop3VXBX01003871.1.smc.gz pop3VXBX01003936.1.smc.gz pop3VXBX01003991.1.smc.gz pop3VXBX01003997.1.smc.gz pop3VXBX01004000.1.smc.gz pop3VXBX01004046.1.smc.gz pop3VXBX01004071.1.smc.gz pop3VXBX01004089.1.smc.gz pop3VXBX01004176.1.smc.gz pop3VXBX01004178.1.smc.gz pop3VXBX01004221.1.smc.gz pop3VXBX01004249.1.smc.gz pop3VXBX01004312.1.smc.gz pop3VXBX01004397.1.smc.gz pop3VXBX01004400.1.smc.gz pop3VXBX01004429.1.smc.gz pop3VXBX01004435.1.smc.gz pop3VXBX01004442.1.smc.gz pop3VXBX01004450.1.smc.gz pop3VXBX01004599.1.smc.gz pop3VXBX01004609.1.smc.gz pop3VXBX01004616.1.smc.gz pop3VXBX01004732.1.smc.gz pop3VXBX01004733.1.smc.gz pop3VXBX01004838.1.smc.gz pop3VXBX01004892.1.smc.gz pop3VXBX01004936.1.smc.gz pop3VXBX01004943.1.smc.gz pop3VXBX01004959.1.smc.gz pop3VXBX01005001.1.smc.gz pop3VXBX01005110.1.smc.gz pop3VXBX01005113.1.smc.gz pop3VXBX01005118.1.smc.gz pop3VXBX01005186.1.smc.gz pop3VXBX01005210.1.smc.gz pop3VXBX01005245.1.smc.gz pop3VXBX01005247.1.smc.gz pop3VXBX01005253.1.smc.gz pop3VXBX01005266.1.smc.gz pop3VXBX01005325.1.smc.gz pop3VXBX01005327.1.smc.gz pop3VXBX01005335.1.smc.gz pop3VXBX01005349.1.smc.gz pop3VXBX01005472.1.smc.gz pop3VXBX01005473.1.smc.gz pop3VXBX01005595.1.smc.gz pop3VXBX01005632.1.smc.gz pop3VXBX01005702.1.smc.gz pop3VXBX01005740.1.smc.gz pop3VXBX01005867.1.smc.gz pop3VXBX01005888.1.smc.gz pop3VXBX01005896.1.smc.gz pop3VXBX01005992.1.smc.gz pop3VXBX01006119.1.smc.gz pop3VXBX01006127.1.smc.gz pop3VXBX01006128.1.smc.gz pop3VXBX01006199.1.smc.gz pop3VXBX01006201.1.smc.gz pop3VXBX01006211.1.smc.gz pop3VXBX01006417.1.smc.gz pop3VXBX01006518.1.smc.gz pop3VXBX01006519.1.smc.gz pop3VXBX01006670.1.smc.gz pop3VXBX01006700.1.smc.gz pop3VXBX01006773.1.smc.gz pop3VXBX01006808.1.smc.gz pop3VXBX01006869.1.smc.gz pop3VXBX01006871.1.smc.gz pop3VXBX01006882.1.smc.gz pop3VXBX01006887.1.smc.gz pop3VXBX01007003.1.smc.gz pop3VXBX01007086.1.smc.gz pop3VXBX01007117.1.smc.gz pop3VXBX01007125.1.smc.gz pop3VXBX01007131.1.smc.gz pop3VXBX01007486.1.smc.gz pop3VXBX01007491.1.smc.gz pop3VXBX01007493.1.smc.gz pop3VXBX01007602.1.smc.gz pop3VXBX01007692.1.smc.gz pop3VXBX01007701.1.smc.gz pop3VXBX01007708.1.smc.gz pop3VXBX01007777.1.smc.gz pop3VXBX01007795.1.smc.gz pop3VXBX01007914.1.smc.gz pop3VXBX01007981.1.smc.gz pop3VXBX01007997.1.smc.gz pop3VXBX01008007.1.smc.gz pop3VXBX01008012.1.smc.gz pop3VXBX01008036.1.smc.gz pop3VXBX01008045.1.smc.gz pop3VXBX01008125.1.smc.gz pop3VXBX01008133.1.smc.gz pop3VXBX01008140.1.smc.gz pop3VXBX01008145.1.smc.gz pop3VXBX01008146.1.smc.gz pop3VXBX01008206.1.smc.gz pop3VXBX01008231.1.smc.gz pop3VXBX01008236.1.smc.gz pop3VXBX01008290.1.smc.gz pop3VXBX01008400.1.smc.gz pop3VXBX01008415.1.smc.gz pop3VXBX01008451.1.smc.gz pop3VXBX01008453.1.smc.gz pop3VXBX01008464.1.smc.gz pop3VXBX01008609.1.smc.gz pop3VXBX01008674.1.smc.gz pop3VXBX01008688.1.smc.gz pop3VXBX01008695.1.smc.gz pop3VXBX01008995.1.smc.gz pop3VXBX01009008.1.smc.gz pop3VXBX01009038.1.smc.gz pop3VXBX01009069.1.smc.gz pop3VXBX01009108.1.smc.gz pop3VXBX01009114.1.smc.gz pop3VXBX01009215.1.smc.gz pop3VXBX01009292.1.smc.gz pop3VXBX01009313.1.smc.gz pop3VXBX01009318.1.smc.gz pop3VXBX01009357.1.smc.gz pop3VXBX01009439.1.smc.gz pop3VXBX01009446.1.smc.gz pop3VXBX01009452.1.smc.gz pop3VXBX01009469.1.smc.gz pop3VXBX01009535.1.smc.gz pop3VXBX01009581.1.smc.gz pop3VXBX01009582.1.smc.gz pop3VXBX01009584.1.smc.gz pop3VXBX01009605.1.smc.gz pop3VXBX01009614.1.smc.gz pop3VXBX01009752.1.smc.gz pop3VXBX01009827.1.smc.gz pop3VXBX01009832.1.smc.gz pop3VXBX01009855.1.smc.gz pop3VXBX01009899.1.smc.gz pop3VXBX01009908.1.smc.gz pop3VXBX01009921.1.smc.gz pop3VXBX01017515.1.smc.gz

# 3. joint generation of smc files from vcf 
for i in $(cat /media/labgenoma5/DATAPART3/bandriola/Scytalopus/SummaryStats/fst/1Mscaffolds.txt); do
    smc++ vcf2smc ~/Scytalopus/vcffiles/FinalVCFs/FilteredPCA_FilteredMax30missingDepthmin5_GeographicNames_allsamples.vcf.gz pop3pop4/pop3pop4$i.smc.gz $i pop3:NorteMantiqueira1_lin3,NorteMantiqueira2_lin3,NorteMantiqueira3_lin3,NorteMantiqueira4_lin3,SulMantiqueira2_lin3,SulMantiqueira3_lin3,SulMantiqueira4_lin3,SulMantiqueira5_lin3,Caparao_lin3 pop4:BocainaSerraDoMarRJ1_lin4,BocainaSerraDoMarRJ3_lin4,BocainaSerraDoMarRJ4_lin4,CunhaSerraDoMarRJ2_lin4
done 

# 4. split
# command 1:  smc++ split -o split/ pop1/model.final.json pop2/model.final.json data/*.smc.gz
# command to plot: smc++ plot joint.pdf split/model.final.json
smc++ split -o splitpop3vspop4/ pop3/pop3.final.json pop4/pop4.final.json pop3pop4/*.smc.gz
smc++ plot --csv -g 3.2 splitpop5pop67/splitpop5pop67.pdf splitpop5pop67/model.final.json
